{"version":3,"sources":["../../../src/providers/InstructionsProvider/useInstructions.ts"],"sourcesContent":["import { useContext, useEffect, useState } from 'react'\n\nimport { handlebarsHelpers, handlebarsHelpersMap } from '../../libraries/handlebars/helpersMap.js'\nimport { InstructionsContext } from './InstructionsProvider.js'\n\nexport const useInstructions = (\n  update: {\n    schemaPath?: unknown\n  } = {},\n) => {\n  const context = useContext(InstructionsContext)\n\n  //Fields are used for autocompletion in PromptTextareaField\n  const fields = Object.keys(context.instructions || {}).map((key) => {\n    return key.split('.').slice(1).join('.')\n  })\n\n  const promptEditorSuggestions = [...fields].reduce((acc, f) => {\n    const fieldKey = Object.keys(context.instructions).find((k) => k.endsWith(f))\n    const fieldInfo = context.instructions[fieldKey]\n\n    // Currently, Upload fields are excluded from suggestions\n    if (fieldInfo.fieldType === 'upload') {\n      return acc\n    }\n\n    const helpers = handlebarsHelpers.filter(\n      (h) => handlebarsHelpersMap[h]?.field === fieldInfo.fieldType,\n    )\n\n    if (helpers.length) {\n      for (const helper of helpers) {\n        acc.push(helper + ` ${f}`)\n      }\n      return acc\n    }\n\n    acc.push(f)\n    return acc\n  }, [])\n\n  const [schemaPath, setSchemaPath] = useState(update.schemaPath as string)\n\n  useEffect(() => {\n    if(update.schemaPath !== schemaPath) {\n      setSchemaPath(update.schemaPath as string)\n    }\n  }, [schemaPath, update])\n\n  return {\n    ...context,\n    ...(context?.instructions ? context?.instructions[schemaPath] : {}),\n    fields,\n    map: context?.instructions,\n    promptEditorSuggestions,\n  }\n}\n"],"names":["useContext","useEffect","useState","handlebarsHelpers","handlebarsHelpersMap","InstructionsContext","useInstructions","update","context","fields","Object","keys","instructions","map","key","split","slice","join","promptEditorSuggestions","reduce","acc","f","fieldKey","find","k","endsWith","fieldInfo","fieldType","helpers","filter","h","field","length","helper","push","schemaPath","setSchemaPath"],"mappings":"AAAA,SAASA,UAAU,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,QAAO;AAEvD,SAASC,iBAAiB,EAAEC,oBAAoB,QAAQ,2CAA0C;AAClG,SAASC,mBAAmB,QAAQ,4BAA2B;AAE/D,OAAO,MAAMC,kBAAkB,CAC7BC,SAEI,CAAC,CAAC;IAEN,MAAMC,UAAUR,WAAWK;IAE3B,2DAA2D;IAC3D,MAAMI,SAASC,OAAOC,IAAI,CAACH,QAAQI,YAAY,IAAI,CAAC,GAAGC,GAAG,CAAC,CAACC;QAC1D,OAAOA,IAAIC,KAAK,CAAC,KAAKC,KAAK,CAAC,GAAGC,IAAI,CAAC;IACtC;IAEA,MAAMC,0BAA0B;WAAIT;KAAO,CAACU,MAAM,CAAC,CAACC,KAAKC;QACvD,MAAMC,WAAWZ,OAAOC,IAAI,CAACH,QAAQI,YAAY,EAAEW,IAAI,CAAC,CAACC,IAAMA,EAAEC,QAAQ,CAACJ;QAC1E,MAAMK,YAAYlB,QAAQI,YAAY,CAACU,SAAS;QAEhD,yDAAyD;QACzD,IAAII,UAAUC,SAAS,KAAK,UAAU;YACpC,OAAOP;QACT;QAEA,MAAMQ,UAAUzB,kBAAkB0B,MAAM,CACtC,CAACC,IAAM1B,oBAAoB,CAAC0B,EAAE,EAAEC,UAAUL,UAAUC,SAAS;QAG/D,IAAIC,QAAQI,MAAM,EAAE;YAClB,KAAK,MAAMC,UAAUL,QAAS;gBAC5BR,IAAIc,IAAI,CAACD,SAAS,CAAC,CAAC,EAAEZ,EAAE,CAAC;YAC3B;YACA,OAAOD;QACT;QAEAA,IAAIc,IAAI,CAACb;QACT,OAAOD;IACT,GAAG,EAAE;IAEL,MAAM,CAACe,YAAYC,cAAc,GAAGlC,SAASK,OAAO4B,UAAU;IAE9DlC,UAAU;QACR,IAAGM,OAAO4B,UAAU,KAAKA,YAAY;YACnCC,cAAc7B,OAAO4B,UAAU;QACjC;IACF,GAAG;QAACA;QAAY5B;KAAO;IAEvB,OAAO;QACL,GAAGC,OAAO;QACV,GAAIA,SAASI,eAAeJ,SAASI,YAAY,CAACuB,WAAW,GAAG,CAAC,CAAC;QAClE1B;QACAI,KAAKL,SAASI;QACdM;IACF;AACF,EAAC"}