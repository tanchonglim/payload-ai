{"version":3,"sources":["../../src/utilities/updateFieldsConfig.ts"],"sourcesContent":["import type { CollectionConfig } from 'payload'\n\ninterface UpdateFieldsConfig {\n  schemaPathMap: Record<string, string>\n  updatedCollectionConfig: CollectionConfig\n}\n\nexport const updateFieldsConfig = (collectionConfig: CollectionConfig, fields: string[]): UpdateFieldsConfig => {\n  let schemaPathMap = {}\n\n  function updateField(field: any, parentPath = ''): any {\n    const currentPath = parentPath ? `${parentPath}.${field.name}` : field.name\n    const currentSchemaPath = `${collectionConfig.slug}.${currentPath}`\n\n    // Disabled fields/ field types\n    if (\n      field.admin?.disabled ||\n      field.admin?.readOnly ||\n      field.admin?.hidden ||\n      field.type === 'row' ||\n      !fields.includes(field.name)\n    ) {\n      return field\n    }\n\n    // Map field path for global fieldInstructionsMap to load related instructions\n    // This is done due to save extra API call to get instructions when Field components are loaded in admin\n    // Doing is will only call instructions data when user clicks on settings\n    if (['richText', 'text', 'textarea', 'upload'].includes(field.type)) {\n      schemaPathMap = {\n        ...schemaPathMap,\n        [currentSchemaPath]: {\n          type: field.type,\n          label: field.label || field.name,\n          relationTo: field.relationTo,\n        },\n      }\n    }\n\n    // Inject AI actions, richText is not included here as it has to be explicitly defined by user\n    if (['text', 'textarea', 'upload'].includes(field.type)) {\n      let customField = {}\n\n      // Custom fields don't fully adhere to the Payload schema, making it difficult to\n      // determine which components support injecting ComposeField as a Description.\n      if (field.admin?.components?.Field || field.admin?.components?.Description) {\n        // TODO: Do something?\n        customField = {}\n      }\n\n      return {\n        ...field,\n        admin: {\n          ...field.admin,\n          components: {\n            ...(field.admin?.components || {}),\n            Description: '@ai-stack/payloadcms/fields#ComposeField',\n            ...customField,\n          },\n        },\n      }\n    }\n\n    if (field.fields) {\n      return {\n        ...field,\n        fields: field.fields.map((subField: any) => updateField(subField, currentPath)),\n      }\n    }\n\n    if (field.tabs) {\n      return {\n        ...field,\n        tabs: field.tabs.map((tab: any) => {\n          return {\n            ...tab,\n            fields: tab.fields.map((subField: any) => updateField(subField, tab.name)),\n          }\n        }),\n      }\n    }\n\n    if (field.blocks) {\n      return {\n        ...field,\n        blocks: field.blocks.map((block: any) => ({\n          ...block,\n          fields: block.fields.map((subField: any) =>\n            updateField(subField, `${currentPath}.${block.slug}`),\n          ),\n        })),\n      }\n    }\n\n    return field\n  }\n\n  const updatedCollectionConfig = {\n    ...collectionConfig,\n    fields: collectionConfig.fields.map((field) => updateField(field)),\n  }\n\n  return {\n    schemaPathMap,\n    updatedCollectionConfig,\n  }\n}\n"],"names":["updateFieldsConfig","collectionConfig","fields","schemaPathMap","updateField","field","parentPath","currentPath","name","currentSchemaPath","slug","admin","disabled","readOnly","hidden","type","includes","label","relationTo","customField","components","Field","Description","map","subField","tabs","tab","blocks","block","updatedCollectionConfig"],"mappings":"AAOA,OAAO,MAAMA,qBAAqB,CAACC,kBAAoCC;IACrE,IAAIC,gBAAgB,CAAC;IAErB,SAASC,YAAYC,KAAU,EAAEC,aAAa,EAAE;QAC9C,MAAMC,cAAcD,aAAa,CAAC,EAAEA,WAAW,CAAC,EAAED,MAAMG,IAAI,CAAC,CAAC,GAAGH,MAAMG,IAAI;QAC3E,MAAMC,oBAAoB,CAAC,EAAER,iBAAiBS,IAAI,CAAC,CAAC,EAAEH,YAAY,CAAC;QAEnE,+BAA+B;QAC/B,IACEF,MAAMM,KAAK,EAAEC,YACbP,MAAMM,KAAK,EAAEE,YACbR,MAAMM,KAAK,EAAEG,UACbT,MAAMU,IAAI,KAAK,SACf,CAACb,OAAOc,QAAQ,CAACX,MAAMG,IAAI,GAC3B;YACA,OAAOH;QACT;QAEA,8EAA8E;QAC9E,wGAAwG;QACxG,yEAAyE;QACzE,IAAI;YAAC;YAAY;YAAQ;YAAY;SAAS,CAACW,QAAQ,CAACX,MAAMU,IAAI,GAAG;YACnEZ,gBAAgB;gBACd,GAAGA,aAAa;gBAChB,CAACM,kBAAkB,EAAE;oBACnBM,MAAMV,MAAMU,IAAI;oBAChBE,OAAOZ,MAAMY,KAAK,IAAIZ,MAAMG,IAAI;oBAChCU,YAAYb,MAAMa,UAAU;gBAC9B;YACF;QACF;QAEA,8FAA8F;QAC9F,IAAI;YAAC;YAAQ;YAAY;SAAS,CAACF,QAAQ,CAACX,MAAMU,IAAI,GAAG;YACvD,IAAII,cAAc,CAAC;YAEnB,iFAAiF;YACjF,8EAA8E;YAC9E,IAAId,MAAMM,KAAK,EAAES,YAAYC,SAAShB,MAAMM,KAAK,EAAES,YAAYE,aAAa;gBAC1E,sBAAsB;gBACtBH,cAAc,CAAC;YACjB;YAEA,OAAO;gBACL,GAAGd,KAAK;gBACRM,OAAO;oBACL,GAAGN,MAAMM,KAAK;oBACdS,YAAY;wBACV,GAAIf,MAAMM,KAAK,EAAES,cAAc,CAAC,CAAC;wBACjCE,aAAa;wBACb,GAAGH,WAAW;oBAChB;gBACF;YACF;QACF;QAEA,IAAId,MAAMH,MAAM,EAAE;YAChB,OAAO;gBACL,GAAGG,KAAK;gBACRH,QAAQG,MAAMH,MAAM,CAACqB,GAAG,CAAC,CAACC,WAAkBpB,YAAYoB,UAAUjB;YACpE;QACF;QAEA,IAAIF,MAAMoB,IAAI,EAAE;YACd,OAAO;gBACL,GAAGpB,KAAK;gBACRoB,MAAMpB,MAAMoB,IAAI,CAACF,GAAG,CAAC,CAACG;oBACpB,OAAO;wBACL,GAAGA,GAAG;wBACNxB,QAAQwB,IAAIxB,MAAM,CAACqB,GAAG,CAAC,CAACC,WAAkBpB,YAAYoB,UAAUE,IAAIlB,IAAI;oBAC1E;gBACF;YACF;QACF;QAEA,IAAIH,MAAMsB,MAAM,EAAE;YAChB,OAAO;gBACL,GAAGtB,KAAK;gBACRsB,QAAQtB,MAAMsB,MAAM,CAACJ,GAAG,CAAC,CAACK,QAAgB,CAAA;wBACxC,GAAGA,KAAK;wBACR1B,QAAQ0B,MAAM1B,MAAM,CAACqB,GAAG,CAAC,CAACC,WACxBpB,YAAYoB,UAAU,CAAC,EAAEjB,YAAY,CAAC,EAAEqB,MAAMlB,IAAI,CAAC,CAAC;oBAExD,CAAA;YACF;QACF;QAEA,OAAOL;IACT;IAEA,MAAMwB,0BAA0B;QAC9B,GAAG5B,gBAAgB;QACnBC,QAAQD,iBAAiBC,MAAM,CAACqB,GAAG,CAAC,CAAClB,QAAUD,YAAYC;IAC7D;IAEA,OAAO;QACLF;QACA0B;IACF;AACF,EAAC"}