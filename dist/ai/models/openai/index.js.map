{"version":3,"sources":["../../../../src/ai/models/openai/index.ts"],"sourcesContent":["import type { SpeechCreateParams } from 'openai/resources/audio/speech'\nimport type { File } from 'payload'\n\nimport { openai } from '@ai-sdk/openai'\nimport { streamText } from 'ai'\n\nimport type { GenerationConfig } from '../../../types.js'\n\nimport { defaultSystemPrompt } from '../../prompts.js'\nimport { generateFileNameByPrompt } from '../../utils/generateFileNameByPrompt.js'\nimport { generateImage } from './generateImage.js'\nimport { generateRichText } from './generateRichText.js'\nimport { generateVoice } from './generateVoice.js'\n\nconst MODEL_KEY = 'Oai'\n\n//TODO: Simplify this file by moving the handlers to separate files and remove duplicate code\nexport const OpenAIConfig: GenerationConfig = {\n  models: [\n    {\n      id: `${MODEL_KEY}-text`,\n      name: 'OpenAI GPT Text',\n      fields: ['text', 'textarea'],\n      handler: async (\n        prompt: string,\n        options: { locale: string; model: string; system: string },\n      ) => {\n        const streamTextResult = await streamText({\n          model: openai(options.model),\n          prompt,\n          system: options.system || defaultSystemPrompt,\n        })\n\n        return streamTextResult.toDataStreamResponse()\n      },\n      output: 'text',\n      settings: {\n        name: `${MODEL_KEY}-text-settings`,\n        type: 'group',\n        admin: {\n          condition(data) {\n            return data['model-id'] === `${MODEL_KEY}-text`\n          },\n        },\n        fields: [\n          {\n            name: 'model',\n            type: 'select',\n            defaultValue: 'gpt-4o-mini',\n            label: 'Model',\n            options: ['gpt-4o', 'gpt-4-turbo', 'gpt-4o-mini', 'gpt-3.5-turbo'],\n          },\n        ],\n        label: 'OpenAI GPT Settings',\n      },\n    },\n    {\n      id: 'dall-e',\n      name: 'OpenAI DALL-E',\n      fields: ['upload'],\n      handler: async (prompt: string, options) => {\n        const imageData = await generateImage(prompt, options)\n        return {\n          data: {\n            alt: imageData.alt,\n          },\n          file: {\n            name: `image_${generateFileNameByPrompt(imageData.alt || prompt)}.jpeg`,\n            data: imageData.buffer,\n            mimetype: 'image/jpeg',\n            size: imageData.buffer.byteLength,\n          } as File,\n        }\n      },\n      output: 'image',\n      settings: {\n        name: 'dalle-e-settings',\n        type: 'group',\n        admin: {\n          condition(data) {\n            return data['model-id'] === 'dall-e'\n          },\n        },\n        fields: [\n          {\n            name: 'version',\n            type: 'select',\n            defaultValue: 'dall-e-3',\n            label: 'Version',\n            options: ['dall-e-3', 'dall-e-2'],\n          },\n          {\n            type: 'row',\n            fields: [\n              {\n                name: 'size',\n                type: 'select',\n                defaultValue: '1024x1024',\n                label: 'Size',\n                options: ['256x256', '512x512', '1024x1024', '1792x1024', '1024x1792'],\n              },\n              {\n                name: 'style',\n                type: 'select',\n                defaultValue: 'natural',\n                label: 'Style',\n                options: ['vivid', 'natural'],\n              },\n            ],\n          },\n          {\n            name: 'enable-prompt-optimization',\n            type: 'checkbox',\n            label: 'Optimize prompt',\n          },\n        ],\n        label: 'OpenAI DALL-E Settings',\n      },\n    },\n    {\n      id: 'tts',\n      name: 'OpenAI Text-to-Speech',\n      fields: ['upload'],\n      handler: async (text: string, options) => {\n        //TODO: change it to open ai text to speech api\n        const voiceData = await generateVoice(text, options)\n        return {\n          data: {\n            alt: text,\n          },\n          file: {\n            name: `voice_${generateFileNameByPrompt(text)}.mp3`,\n            data: voiceData.buffer,\n            mimetype: 'audio/mp3',\n            size: voiceData.buffer.byteLength,\n          } as File,\n        }\n      },\n      output: 'audio',\n      settings: {\n        name: `${MODEL_KEY}-tts-settings`,\n        type: 'group',\n        admin: {\n          condition(data) {\n            return data['model-id'] === 'tts'\n          },\n        },\n        fields: [\n          {\n            name: 'voice',\n            type: 'select',\n            defaultValue: 'alloy',\n            label: 'Voice',\n            options: ['alloy', 'echo', 'fable', 'onyx', 'nova', 'shimmer'] as Array<\n              SpeechCreateParams['voice']\n            >,\n          },\n          {\n            name: 'model',\n            type: 'select',\n            defaultValue: 'tts-1',\n            label: 'Model',\n            options: ['tts-1', 'tts-1-hd'] as Array<SpeechCreateParams['model']>,\n          },\n          {\n            name: 'response_format',\n            type: 'select',\n            defaultValue: 'mp3',\n            label: 'Response Format',\n            options: ['mp3', 'opus', 'aac', 'flac', 'wav', 'pcm'] as Array<\n              SpeechCreateParams['response_format']\n            >,\n          },\n          {\n            name: 'speed',\n            type: 'number',\n            defaultValue: 1,\n            label: 'Speed',\n            max: 4,\n            min: 0.25,\n          },\n        ],\n        label: 'OpenAI Text-to-Speech Settings',\n      },\n    },\n    {\n      id: `${MODEL_KEY}-object`,\n      name: 'OpenAI GPT',\n      fields: ['richText'],\n      handler: (text: string, options) => {\n        return generateRichText(text, options)\n      },\n      output: 'text',\n      settings: {\n        name: `${MODEL_KEY}-object-settings`,\n        type: 'group',\n        admin: {\n          condition(data) {\n            return data['model-id'] === `${MODEL_KEY}-object`\n          },\n        },\n        fields: [\n          {\n            name: 'model',\n            type: 'select',\n            defaultValue: 'gpt-4o-2024-08-06',\n            label: 'Model',\n            options: ['gpt-4o', 'gpt-4-turbo', 'gpt-4o-mini', 'gpt-4o-2024-08-06'],\n          },\n        ],\n        label: 'OpenAI GPT Settings',\n      },\n    },\n  ],\n  provider: 'OpenAI',\n}\n"],"names":["openai","streamText","defaultSystemPrompt","generateFileNameByPrompt","generateImage","generateRichText","generateVoice","MODEL_KEY","OpenAIConfig","models","id","name","fields","handler","prompt","options","streamTextResult","model","system","toDataStreamResponse","output","settings","type","admin","condition","data","defaultValue","label","imageData","alt","file","buffer","mimetype","size","byteLength","text","voiceData","max","min","provider"],"mappings":"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"}